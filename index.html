<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Somatório por Vendedor</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background:#f5f5f5; }
  h1 { margin-bottom: 10px; }
  .card {
    background:#fff; padding:20px; border-radius:10px;
    box-shadow:0 2px 8px rgba(0,0,0,0.1); max-width:600px;
  }
  input[type="file"] { margin: 10px 0 20px 0; }
  table { border-collapse: collapse; width:100%; margin-top:10px; }
  table, th, td { border: 1px solid #ccc; }
  th, td { padding: 8px; text-align: left; }
  th { background:#eee; }
</style>
</head>
<body>

<div class="card">
  <h1>Somar Valor Total por Vendedor</h1>
  <p>Importe a planilha (coluna F = valor, coluna Q = vendedor).</p>
  <input type="file" id="inputExcel" accept=".xlsx, .xls">
  <h2>Resultado:</h2>
  <div id="resultado"></div>
</div>

<script>
document.getElementById('inputExcel').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();

  reader.onload = function(event) {
    const data = new Uint8Array(event.target.result);
    const workbook = XLSX.read(data, { type: 'array' });

    const sheet = workbook.Sheets[workbook.SheetNames[0]];

    // Converte para matriz (array de arrays) mantendo letras de coluna por posição
    const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });

    // Índices: F = 5, Q = 16 (0-based)
    const COL_VALOR = 5;   // F
    const COL_VENDEDOR = 16; // Q

    const totais = {};

    // Começa da linha 1 (pulando o cabeçalho na linha 0)
    for (let i = 1; i < rows.length; i++) {
      const linha = rows[i];
      if (!linha) continue;

      const vendedor = linha[COL_VENDEDOR];
      let valorBruto = linha[COL_VALOR];

      if (vendedor == null || valorBruto == null) continue;

      // Converte para string e troca vírgula por ponto
      valorBruto = String(valorBruto).toString().replace('.', '').replace(',', '.');

      let valor = parseFloat(valorBruto);
      if (isNaN(valor)) continue;

      if (!totais[vendedor]) totais[vendedor] = 0;
      totais[vendedor] += valor;
    }

    // Monta tabela HTML
    let html = "<table><tr><th>Vendedor</th><th>Total</th></tr>";

    const vendedores = Object.keys(totais);
    if (vendedores.length === 0) {
      html += "<tr><td colspan='2'>Nenhum dado encontrado. Confira se a coluna F é valor e Q é vendedor.</td></tr>";
    } else {
      vendedores.forEach(v => {
        html += `
          <tr>
            <td>${v}</td>
            <td>R$ ${totais[v].toFixed(2)}</td>
          </tr>
        `;
      });
    }

    html += "</table>";
    document.getElementById("resultado").innerHTML = html;
  };

  reader.readAsArrayBuffer(file);
});
</script>

</body>
</html>
