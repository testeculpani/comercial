<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel de Vendas por Vendedor</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #0ea5e9, #22c55e);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      color: #0f172a;
    }
    .container {
      width: 100%;
      max-width: 1000px;
      background: rgba(255, 255, 255, 0.97);
      border-radius: 18px;
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.35);
      padding: 24px 26px 28px 26px;
      position: relative;
      overflow: hidden;
    }
    .container::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top right, rgba(56, 189, 248, 0.12), transparent 55%),
                  radial-gradient(circle at bottom left, rgba(34, 197, 94, 0.13), transparent 55%);
      pointer-events: none;
      z-index: -1;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 18px;
    }
    .title-area {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    h1 {
      margin: 0;
      font-size: 22px;
      display: flex;
      align-items: center;
      gap: 8px;
      color: #020617;
    }
    h1 span.icon {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      background: linear-gradient(135deg, #0ea5e9, #22c55e);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      color: white;
      box-shadow: 0 6px 16px rgba(34, 197, 94, 0.45);
    }
    .subtitle {
      font-size: 13px;
      color: #64748b;
    }
    .badge {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      background: #e0f2fe;
      color: #0369a1;
      border: 1px solid #bae6fd;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }
    .badge-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.25);
    }

    .upload-area {
      margin-top: 12px;
      margin-bottom: 16px;
      padding: 14px;
      border-radius: 14px;
      border: 1px dashed #cbd5f5;
      background: #f8fafc;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px 14px;
      justify-content: space-between;
    }
    .upload-info {
      font-size: 13px;
      color: #475569;
    }
    .upload-info strong {
      color: #0f172a;
    }
    .file-input-wrapper {
      position: relative;
      overflow: hidden;
      display: inline-block;
    }
    .file-input-wrapper input[type="file"] {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
    }
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border-radius: 999px;
      padding: 8px 14px;
      border: none;
      background: linear-gradient(135deg, #0ea5e9, #22c55e);
      color: white;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 8px 16px rgba(14, 165, 233, 0.45);
      transition: transform 0.1s ease, box-shadow 0.1s ease, filter 0.1s ease;
      white-space: nowrap;
    }
    .btn.secondary {
      background: #0f172a;
      box-shadow: 0 6px 14px rgba(15, 23, 42, 0.4);
    }
    .btn span.icon {
      font-size: 15px;
    }
    .btn:active {
      transform: translateY(1px);
      box-shadow: 0 6px 14px rgba(14, 165, 233, 0.4);
      filter: brightness(0.98);
    }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
      margin-bottom: 10px;
    }
    .summary-card {
      background: white;
      border-radius: 12px;
      padding: 10px 12px;
      border: 1px solid #e2e8f0;
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.08);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .summary-label {
      font-size: 11px;
      color: #64748b;
      text-transform: uppercase;
      letter-spacing: 0.03em;
    }
    .summary-value {
      font-size: 18px;
      font-weight: 700;
      color: #0f172a;
    }
    .summary-chip {
      font-size: 11px;
      color: #16a34a;
    }

    .actions-row {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-bottom: 8px;
      font-size: 11px;
      color: #64748b;
      align-items: center;
      flex-wrap: wrap;
    }
    .hint {
      font-size: 11px;
      color: #94a3b8;
    }

    .table-wrapper {
      margin-top: 4px;
      border-radius: 14px;
      border: 1px solid #e2e8f0;
      overflow: hidden;
      background: white;
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.12);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }
    thead {
      background: #0f172a;
      color: #e5e7eb;
    }
    th, td {
      padding: 8px 10px;
      text-align: left;
    }
    th {
      font-weight: 600;
      border-bottom: 1px solid #1e293b;
      cursor: default;
      user-select: none;
    }
    th.sortable {
      cursor: pointer;
    }
    th.sortable:hover {
      background: #111827;
    }
    th .sort-indicator {
      font-size: 10px;
      opacity: 0.7;
      margin-left: 4px;
    }
    tbody tr:nth-child(even) {
      background: #f8fafc;
    }
    tbody tr:hover {
      background: #e0f2fe;
    }
    .td-vendedor {
      font-weight: 600;
      color: #0f172a;
    }
    .td-total {
      font-feature-settings: "tnum" 1, "lnum" 1;
      text-align: right;
    }
    .td-resp {
      text-align: center;
      font-size: 12px;
    }
    .tag-alexandre {
      display: inline-block;
      padding: 2px 10px;
      border-radius: 999px;
      background: #dcfce7;
      color: #16a34a;
      font-weight: 700;
      font-size: 11px;
      letter-spacing: 0.03em;
      text-transform: uppercase;
    }
    .tag-jumahil {
      display: inline-block;
      padding: 2px 10px;
      border-radius: 999px;
      background: #fee2e2;
      color: #dc2626;
      font-weight: 700;
      font-size: 11px;
      letter-spacing: 0.03em;
      text-transform: uppercase;
    }
    .empty-state {
      padding: 16px;
      text-align: center;
      font-size: 13px;
      color: #64748b;
    }
    .footer-note {
      margin-top: 10px;
      font-size: 11px;
      color: #94a3b8;
      display: flex;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    /* Aba de vendedores sem venda */
    #semVendasWrapper {
      margin-top: 16px;
      display: none;
    }
    #semVendasWrapper h3 {
      font-size: 15px;
      margin: 0 0 6px 0;
      color: #0f172a;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    #semVendasWrapper h3 span {
      font-size: 18px;
    }
    #semVendasWrapper .subtitle-small {
      font-size: 11px;
      color: #64748b;
      margin-bottom: 8px;
    }

    @media (max-width: 820px) {
      .container {
        padding: 18px 16px 22px 16px;
      }
      header {
        flex-direction: column;
        align-items: flex-start;
      }
      .summary-grid {
        grid-template-columns: 1fr;
      }
      th, td {
        padding: 7px 8px;
      }
      .actions-row {
        justify-content: flex-start;
      }
    }
  </style>
</head>
<body>

<div class="container">
  <header>
    <div class="title-area">
      <h1><span class="icon">‚Çø</span> Painel de Vendas por Vendedor</h1>
      <div class="subtitle">
        Importe sua planilha e veja o total vendido por cada vendedor<br>
        <small>
          Soma da coluna <strong>J</strong> por vendedor da <strong>I</strong>,<br>
          apenas se:
          <strong>R</strong> come√ßar com "venda" e
          <strong>B</strong> for Pendente / Aprovado / Atendido / Em Altera√ß√£o / Validado. <br>
          Alguns vendedores s√£o marcados como <strong>ALEXANDRE</strong> (verde) ou <strong>JUMAHIL</strong> (vermelho).
        </small>
      </div>
    </div>
    <div class="badge">
      <span class="badge-dot"></span>
      J = valor ¬∑ I = vendedor ¬∑ R "venda..." ¬∑ B status v√°lido
    </div>
  </header>

  <div class="upload-area">
    <div class="upload-info">
      <div><strong>1)</strong> Clique no bot√£o ao lado e selecione sua planilha (.xls ou .xlsx).</div>
      <div><strong>2)</strong> Entram no c√°lculo s√≥ as linhas com R iniciando em <strong>"venda"</strong> e status da coluna <strong>B</strong> permitido.</div>
    </div>
    <div class="file-input-wrapper">
      <button class="btn">
        <span class="icon">üìé</span>
        Importar planilha
      </button>
      <input type="file" id="inputExcel" accept=".xlsx, .xls">
    </div>
  </div>

  <div class="summary-grid">
    <div class="summary-card">
      <div class="summary-label">Total geral vendido</div>
      <div id="totalGeral" class="summary-value">R$ 0,00</div>
      <div class="summary-chip" id="totalRegistros">0 linhas v√°lidas</div>
    </div>
    <div class="summary-card">
      <div class="summary-label">Quantidade de vendedores</div>
      <div id="qtdVendedores" class="summary-value">0</div>
      <div class="summary-chip">Com pelo menos 1 venda v√°lida</div>
    </div>
    <div class="summary-card">
      <div class="summary-label">Maior vendedor</div>
      <div id="topVendedor" class="summary-value">‚Äì</div>
      <div class="summary-chip" id="topVendedorValor">R$ 0,00</div>
    </div>
  </div>

  <div class="actions-row">
    <span class="hint">Clique em <strong>Respons√°vel</strong> para ordenar por supervisor.</span>
    <button class="btn secondary" id="btnSemVendas">
      <span class="icon">üîç</span>
      Ver vendedores ALEXANDRE/JUMAHIL sem vendas
    </button>
  </div>

  <div class="table-wrapper" id="tabelaContainer">
    <table>
      <thead>
        <tr>
          <th id="thVendedor" class="sortable">Vendedor (I) <span class="sort-indicator" id="sortIndicadorV">‚ñº</span></th>
          <th style="text-align:right;">Total vendido (soma de J)</th>
          <th id="thResponsavel" class="sortable" style="text-align:center;">
            Respons√°vel
            <span class="sort-indicator" id="sortIndicadorR">-</span>
          </th>
        </tr>
      </thead>
      <tbody id="tbodyVendedores">
        <tr><td colspan="3" class="empty-state">Nenhuma planilha importada ainda.</td></tr>
      </tbody>
    </table>
  </div>

  <div id="semVendasWrapper">
    <h3><span>üìã</span> Vendedores ALEXANDRE / JUMAHIL sem nenhuma venda</h3>
    <div class="subtitle-small">Considerando apenas a regra atual de filtro (R iniciando em "venda" e status B permitido).</div>
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Vendedor</th>
            <th style="text-align:center;">Respons√°vel</th>
            <th>Situa√ß√£o</th>
          </tr>
        </thead>
        <tbody id="tbodySemVendas">
          <tr><td colspan="3" class="empty-state">Importe uma planilha para ver os resultados.</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="footer-note">
    <span>Lendo colunas <strong>I</strong> (vendedor), <strong>J</strong> (valor), <strong>R</strong> (descri√ß√£o) e <strong>B</strong> (status).</span>
    <span>Apenas linhas com R iniciando em "venda" e status B dentro da lista entram no c√°lculo. Vendedores podem ser ALEXANDRE ou JUMAHIL.</span>
  </div>
</div>

<script>
  const inputExcel = document.getElementById('inputExcel');
  const tbodyVendedores = document.getElementById('tbodyVendedores');
  const tbodySemVendas = document.getElementById('tbodySemVendas');
  const totalGeralEl = document.getElementById('totalGeral');
  const totalRegistrosEl = document.getElementById('totalRegistros');
  const qtdVendedoresEl = document.getElementById('qtdVendedores');
  const topVendedorEl = document.getElementById('topVendedor');
  const topVendedorValorEl = document.getElementById('topVendedorValor');
  const btnSemVendas = document.getElementById('btnSemVendas');
  const semVendasWrapper = document.getElementById('semVendasWrapper');

  const thResponsavel = document.getElementById('thResponsavel');
  const thVendedor = document.getElementById('thVendedor');
  const sortIndicadorV = document.getElementById('sortIndicadorV');
  const sortIndicadorR = document.getElementById('sortIndicadorR');

  const STATUS_VALIDOS = [
    'pendente',
    'aprovado',
    'atendido',
    'em altera√ß√£o',
    'em alteracao',
    'validado'
  ];

  // Lista de vendedores ALEXANDRE
  const VENDEDORES_ALEXANDRE = [
    "ANDERSON MAICO FREDERICO REPRESENTACOES COMER",
    "J. G. VARGAS REPRESENTACOES COMERCIAIS MARING",
    "60.132.034 MOHANDAS VINICIUS DA SILVA DELL IS",
    "HOPPE REPRESENTACOES LTDA",
    "FURLANETTO E GONCALVES LTDA",
    "ROGERIO ANTONELLO DA ROSA",
    "TAVARES IMPORTA√á√ÉO E COMERCIO LTDA",
    "MICAEL MENEZES DE OLIVEIRA",
    "ANGELA DE FATIMA ALVES SOUZA 48825433034",
    "P. F. VIEIRA FARIA & CIA LTDA",
    "ROCELU REPRESENTACAO COMERCIAL LTDA",
    "AUTHENTIC SALES REPRESENTACOES LTDA",
    "MAZINHO REPRESENTACAO COMERCIAL LTDA",
    "V9 REPRESENTACOES E EVENTOS LTDA",
    "AMARILDO DE LELIS OLIVEIRA RIOS",
    "STRONG REPRESENTACOES LTDA",
    "J. R. QUARESMA REPRESENTACAO COMERCIAL DE U. D. LTDA",
    "CARLOS ALBERTO LEHRBACK BARBOSA ME",
    "JOSE WANDERLEY PEREIRA DOS SANTOS REPRES",
    "R C SANTOS REPRESENTACOES LTDA",
    "MARFIGRAN SP DISTRIBUIDORA LTDA",
    "REMA REPRESENTACAO E APOIO ADMINISTRATIVO LTD",
    "MARCIO CORAINE",
    "AATR - REPRESENTACOES COMERCIAIS LTDA",
    "FEROLETO REPRESENTACAO E COMERCIO DE UTILIDAD",
    "WELLINGTON L. F. ARTAL LTDA",
    "DAL EVEDOVE LIMA COMERCIAL LTDA",
    "MENESES E BRAGA REPRESENTACOES LTDA ME",
    "FORTES REPRESENTACOES LTDA",
    "RICARDO BEZERRA REPRESENTACOES LTDA",
    "VALDEMIR ASTRESSE",
    "53.836.657 FRANCISCO CARDOSO DE SOUSA ROCHA",
    "RRB REPRESENTACAO E COMERCIO DE ARTIGOS ESPORTIVOS LTDA",
    "MAPRI REPRESENTA√á√ïES LTDA"
  ];

  // Lista de vendedores JUMAHIL
  const VENDEDORES_JUMAHIL = [
    "CLEBSON MARQUES LOPES 71545808287",
    "J F A N REPRESENTACOES LTDA",
    "E CORDEIRO CAMPOS",
    "ERISVALDO PEREIRA FERREIRA",
    "SETCOM COMERCIO LTDA",
    "V. R. PACIFICO",
    "A B DE OLIVEIRA FILHO REPRESENTACOES LTDA",
    "JOANE SILVA SANTOS",
    "FENIX REPRESENTACOES LTDA",
    "J P DA SILVA REPRESENTANTE COMERCIAL EIRELI",
    "E O DUARTE REPRESENTACOES LTDA.",
    "JK COMERCIO E REPRESENTACAO LTDA",
    "HUNTERS REPRESENTA√á√ïES LTDA",
    "LUIZ H. ZORDAN",
    "MARCONI REPRESENTA√áOES",
    "C N DE MELO REPRESENTACOES DE MATERIAL DE CON",
    "ELUILSON FELIPE DE SOUZA JUNIOR - ME",
    "CURITINTAS REPRESENTACOES EIRELI",
    "E.M. RIBEIRO LTDA",
    "JOSE CARLOS MACEDO JUNIOR & CIA LTDA",
    "CEZAR LUIZ HOOGEVOONINK",
    "ARENDT E RAMOS REPRESENTACOES COMERCIAIS LTDA",
    "FREITAS REPRESENTACAO COMERCIAL LTDA",
    "GILSON CARLOS DALLA COSTA PEREIRA & CIA",
    "QUEIROZ & QUEIROZ REP COMERCIAIS LTDA",
    "EXPOMARCAS COMERCIAL EXPORTADORA DE MANUFATURADOS LTDA",
    "S. SILVA REPRESENTACOES LTDA",
    "VIDAL REPRESENTACOES LTDA",
    "ANTONIO CARLOS RAVANELLO 38377870010",
    "ARV REPRESENTACAO COMERCIAL LTDA",
    "E. L. BIAVATTI & CIA. LTDA.",
    "LEANDRO DE SOUZA LTDA",
    "SANTORO GESTAO E VENDAS LTDA",
    "ANA JANET ZULIANI 54224055015",
    "LUCIANO GONCALVES RODRIGUES",
    "PAIDEIA AGORA COM DE BEB E REP LTDA ME",
    "VIALE BR EMPREENDIMENTOS LTDA"
  ];

  function formatCurrency(valor) {
    return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
  }

  function getResponsavel(vendedor) {
    if (VENDEDORES_ALEXANDRE.includes(vendedor)) return 'ALEXANDRE';
    if (VENDEDORES_JUMAHIL.includes(vendedor)) return 'JUMAHIL';
    return null;
  }

  let ultimaListaVendedores = []; // [{vendedor, total, resp}]
  let listaSemVendas = [];       // [{vendedor, resp}]
  let sortMode = 'valor';        // 'valor' ou 'responsavel'

  function atualizarIndicadoresOrdenacao() {
    if (sortMode === 'valor') {
      sortIndicadorV.textContent = '‚ñº';
      sortIndicadorR.textContent = '-';
    } else {
      sortIndicadorV.textContent = '-';
      sortIndicadorR.textContent = '‚ñº';
    }
  }

  function renderTabelaPrincipal() {
    tbodyVendedores.innerHTML = '';

    if (ultimaListaVendedores.length === 0) {
      const tr = document.createElement('tr');
      const td = document.createElement('td');
      td.colSpan = 3;
      td.className = 'empty-state';
      td.textContent = 'Nenhuma linha v√°lida encontrada. Confira R iniciando em "venda", I com vendedor, J com valor e B com status permitido.';
      tr.appendChild(td);
      tbodyVendedores.appendChild(tr);
      return;
    }

    // Ordena conforme modo atual
    const dadosOrdenados = [...ultimaListaVendedores];

    if (sortMode === 'valor') {
      dadosOrdenados.sort((a, b) => b.total - a.total);
    } else if (sortMode === 'responsavel') {
      const rankResp = { 'ALEXANDRE': 1, 'JUMAHIL': 2, '': 3 };
      dadosOrdenados.sort((a, b) => {
        const ra = rankResp[a.resp || ''] || 99;
        const rb = rankResp[b.resp || ''] || 99;
        if (ra !== rb) return ra - rb;
        return b.total - a.total; // dentro de cada grupo, por valor
      });
    }

    dadosOrdenados.forEach(item => {
      const tr = document.createElement('tr');

      const tdVendedor = document.createElement('td');
      tdVendedor.textContent = item.vendedor;
      tdVendedor.className = 'td-vendedor';

      const tdTotal = document.createElement('td');
      tdTotal.textContent = formatCurrency(item.total);
      tdTotal.className = 'td-total';

      const tdResp = document.createElement('td');
      tdResp.className = 'td-resp';

      if (item.resp === 'ALEXANDRE') {
        tdResp.innerHTML = '<span class="tag-alexandre">ALEXANDRE</span>';
      } else if (item.resp === 'JUMAHIL') {
        tdResp.innerHTML = '<span class="tag-jumahil">JUMAHIL</span>';
      } else {
        tdResp.textContent = '';
      }

      tr.appendChild(tdVendedor);
      tr.appendChild(tdTotal);
      tr.appendChild(tdResp);
      tbodyVendedores.appendChild(tr);
    });
  }

  function renderTabelaSemVendas() {
    tbodySemVendas.innerHTML = '';

    if (listaSemVendas.length === 0) {
      const tr = document.createElement('tr');
      const td = document.createElement('td');
      td.colSpan = 3;
      td.className = 'empty-state';
      td.textContent = 'Nenhum vendedor ALEXANDRE/JUMAHIL zerado dentro da regra atual.';
      tr.appendChild(td);
      tbodySemVendas.appendChild(tr);
      return;
    }

    // Ordena por respons√°vel (ALEXANDRE, JUMAHIL) e nome
    const dados = [...listaSemVendas];
    const rankResp = { 'ALEXANDRE': 1, 'JUMAHIL': 2 };
    dados.sort((a, b) => {
      const ra = rankResp[a.resp] || 99;
      const rb = rankResp[b.resp] || 99;
      if (ra !== rb) return ra - rb;
      return a.vendedor.localeCompare(b.vendedor);
    });

    dados.forEach(item => {
      const tr = document.createElement('tr');

      const tdV = document.createElement('td');
      tdV.textContent = item.vendedor;

      const tdR = document.createElement('td');
      tdR.style.textAlign = 'center';
      if (item.resp === 'ALEXANDRE') {
        tdR.innerHTML = '<span class="tag-alexandre">ALEXANDRE</span>';
      } else if (item.resp === 'JUMAHIL') {
        tdR.innerHTML = '<span class="tag-jumahil">JUMAHIL</span>';
      } else {
        tdR.textContent = item.resp || '';
      }

      const tdS = document.createElement('td');
      tdS.textContent = 'Sem vendas na regra atual';

      tr.appendChild(tdV);
      tr.appendChild(tdR);
      tr.appendChild(tdS);
      tbodySemVendas.appendChild(tr);
    });
  }

  inputExcel.addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();

    reader.onload = function(event) {
      const data = new Uint8Array(event.target.result);
      const workbook = XLSX.read(data, { type: 'array' });

      const sheet = workbook.Sheets[workbook.SheetNames[0]];
      if (!sheet || !sheet['!ref']) {
        alert('N√£o foi poss√≠vel ler a planilha. Confira se h√° dados na aba 1.');
        return;
      }

      const range = XLSX.utils.decode_range(sheet['!ref']);

      const totais = {};
      let totalGeral = 0;
      let linhasValidas = 0;

      // Percorre as linhas da planilha, ignorando cabe√ßalho (come√ßa da segunda linha)
      for (let r = range.s.r + 1; r <= range.e.r; r++) {
        const rowNumber = r + 1; // linhas no Excel s√£o 1-based

        const cellVendedor = sheet['I' + rowNumber];  // coluna I = vendedor
        const cellValor   = sheet['J' + rowNumber];   // coluna J = valor
        const cellDesc    = sheet['R' + rowNumber];   // coluna R = descri√ß√£o
        const cellStatus  = sheet['B' + rowNumber];   // coluna B = status

        // precisa ter descri√ß√£o, vendedor, valor e status
        if (!cellDesc || cellDesc.v == null) continue;
        if (!cellVendedor || cellVendedor.v == null) continue;
        if (!cellValor || cellValor.v == null) continue;
        if (!cellStatus || cellStatus.v == null) continue;

        const descricao = String(cellDesc.v).trim().toLowerCase();
        const statusRaw = String(cellStatus.v).trim().toLowerCase();

        // filtro 1: R come√ßa com "venda"
        if (!descricao.startsWith('venda')) {
          continue;
        }

        // filtro 2: status B dentro da lista
        if (!STATUS_VALIDOS.includes(statusRaw)) {
          continue;
        }

        const vendedor = String(cellVendedor.v).trim();
        let bruto = cellValor.v;

        // Trata valor:
        if (typeof bruto === 'string') {
          let s = bruto.trim();
          s = s.replace(/\./g, ''); // remove pontos (milhares)
          s = s.replace(',', '.');  // troca v√≠rgula por ponto
          bruto = s;
        }

        const valor = parseFloat(bruto);
        if (isNaN(valor)) continue;

        if (!totais[vendedor]) {
          totais[vendedor] = 0;
        }
        totais[vendedor] += valor;
        totalGeral += valor;
        linhasValidas++;
      }

      // Atualiza resumo
      totalGeralEl.textContent = formatCurrency(totalGeral);
      totalRegistrosEl.textContent = `${linhasValidas} linhas v√°lidas (R "venda..." + status B permitido)`;
      const vendedores = Object.keys(totais);
      qtdVendedoresEl.textContent = vendedores.length;

      // Descobre maior vendedor
      if (vendedores.length > 0) {
        let melhor = vendedores[0];
        vendedores.forEach(v => {
          if (totais[v] > totais[melhor]) melhor = v;
        });
        topVendedorEl.textContent = melhor;
        topVendedorValorEl.textContent = formatCurrency(totais[melhor] || 0);
      } else {
        topVendedorEl.textContent = '‚Äì';
        topVendedorValorEl.textContent = 'R$ 0,00';
      }

      // Monta lista principal com responsavel
      ultimaListaVendedores = vendedores.map(v => ({
        vendedor: v,
        total: totais[v],
        resp: getResponsavel(v) || ''
      }));

      // Calcula lista de vendedores sem vendas (ALEXANDRE / JUMAHIL)
      listaSemVendas = [];
      const setComVenda = new Set(vendedores);

      VENDEDORES_ALEXANDRE.forEach(nome => {
        if (!setComVenda.has(nome)) {
          listaSemVendas.push({ vendedor: nome, resp: 'ALEXANDRE' });
        }
      });
      VENDEDORES_JUMAHIL.forEach(nome => {
        if (!setComVenda.has(nome)) {
          listaSemVendas.push({ vendedor: nome, resp: 'JUMAHIL' });
        }
      });

      // reset ordena√ß√£o para valor
      sortMode = 'valor';
      atualizarIndicadoresOrdenacao();
      renderTabelaPrincipal();
      renderTabelaSemVendas();
      // mostra se√ß√£o de sem vendas se j√° estiver aberta
      // (n√£o muda estado do display aqui)
    };

    reader.readAsArrayBuffer(file);
  });

  // Toggle da aba de vendedores sem vendas
  btnSemVendas.addEventListener('click', () => {
    if (semVendasWrapper.style.display === 'none' || semVendasWrapper.style.display === '') {
      semVendasWrapper.style.display = 'block';
      btnSemVendas.innerHTML = '<span class="icon">‚¨ÜÔ∏è</span> Ocultar vendedores sem vendas';
      renderTabelaSemVendas();
    } else {
      semVendasWrapper.style.display = 'none';
      btnSemVendas.innerHTML = '<span class="icon">üîç</span> Ver vendedores ALEXANDRE/JUMAHIL sem vendas';
    }
  });

  // Ordenar por valor (padr√£o) ao clicar em "Vendedor"
  thVendedor.addEventListener('click', () => {
    if (ultimaListaVendedores.length === 0) return;
    sortMode = 'valor';
    atualizarIndicadoresOrdenacao();
    renderTabelaPrincipal();
  });

  // Ordenar por respons√°vel ao clicar em "Respons√°vel"
  thResponsavel.addEventListener('click', () => {
    if (ultimaListaVendedores.length === 0) return;
    sortMode = 'responsavel';
    atualizarIndicadoresOrdenacao();
    renderTabelaPrincipal();
  });

  // Estado inicial da aba de sem vendas
  semVendasWrapper.style.display = 'none';
  atualizarIndicadoresOrdenacao();
</script>

</body>
</html>
